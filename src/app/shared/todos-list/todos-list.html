@if (loading()) {
  <div class="d-flex justify-content-center">
    <div class="spinner-border" role="status" aria-label="Loading todos">
      <span class="visually-hidden">Loading todos...</span>
    </div>
  </div>
} @else if (error()) {
  <div class="alert alert-danger" role="alert" aria-live="polite">
    {{ error() }}
  </div>
} @else if (todos().length > 0) {
  @if (displayMode() === 'grid') {
    <div class="todos-grid">
      <div class="row">
        @for (todo of todos(); track trackByTodoId($index, todo)) {
          <div class="col-lg-6 col-xl-4 mb-3">
            <div class="card h-100">
              <div class="card-body d-flex flex-column">
                <div class="d-flex align-items-start mb-2">
                  <div class="todo-status me-3">
                    @if (todo.completed) {
                      <span class="completed-todo" aria-label="Completed">
                        <i class="text-success fs-4">✓</i>
                      </span>
                    } @else {
                      <span class="pending-todo" aria-label="Pending">
                        <i class="text-danger fs-4">✗</i>
                      </span>
                    }
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="card-title" 
                        [class]="todo.completed ? 'completed-todo' : 'pending-todo'">
                      {{ todo.title }}
                    </h6>
                  </div>
                </div>
                <div class="mt-auto">
                  <span class="badge" 
                        [class]="todo.completed ? 'bg-success' : 'bg-danger'">
                    {{ todo.completed ? 'Completed' : 'Pending' }}
                  </span>
                  @if (showTodoId()) {
                    <small class="text-muted d-block mt-1">
                      Todo ID: {{ todo.id }}
                    </small>
                  }
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  } @else {
    <div class="todos-list" role="list" [attr.aria-label]="ariaLabel()">
      @for (todo of todos(); track trackByTodoId($index, todo)) {
        <div class="todo-item d-flex align-items-center p-3 border rounded mb-2" 
             role="listitem"
             tabindex="0"
             [attr.aria-label]="'Todo: ' + todo.title + ', Status: ' + (todo.completed ? 'Completed' : 'Pending')"
             (keydown)="onTodoKeyDown($event, todo)"
             (click)="onTodoClick(todo)">
          <div class="todo-status me-3" aria-hidden="true">
            @if (todo.completed) {
              <span class="completed-todo">
                <i class="text-success">✓</i>
              </span>
            } @else {
              <span class="pending-todo">
                <i class="text-danger">✗</i>
              </span>
            }
          </div>
          <div class="todo-content flex-grow-1">
            <p class="mb-0" [class]="todo.completed ? 'completed-todo fw-bold' : 'pending-todo fw-bold'">
              {{ todo.title }}
            </p>
            <small class="text-muted">
              Status: {{ todo.completed ? 'Completed' : 'Pending' }}
            </small>
            @if (showTodoId()) {
              <small class="text-muted d-block">
                Todo ID: {{ todo.id }}
              </small>
            }
          </div>
        </div>
      }
    </div>
  }

  @if (showStats()) {
    <div class="mt-3">
      <div class="row">
        <div class="col-sm-6">
          <p class="text-muted mb-0">
            Total todos: {{ todos().length }}
          </p>
        </div>
        <div class="col-sm-6">
          <p class="text-muted mb-0">
            Completed: {{ getCompletedCount() }} / 
            Pending: {{ getPendingCount() }}
          </p>
        </div>
      </div>
    </div>
  }
} @else {
  <div class="text-center text-muted">
    {{ emptyMessage() || 'No todos found.' }}
  </div>
}