<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h3 class="card-title mb-0">Live Currency Exchange (USD → JPY)</h3>
        <div class="d-flex align-items-center gap-2">
          <span class="badge bg-info">
            @if (isMockMode) {
              Mock Mode
            } @else {
              Live Mode
            }
          </span>
          <button 
            class="btn btn-sm btn-outline-secondary" 
            (click)="toggleMockMode()"
            [attr.aria-label]="isMockMode ? 'Switch to live mode' : 'Switch to mock mode'">
            @if (isMockMode) {
              Switch to Live
            } @else {
              Switch to Mock
            }
          </button>
        </div>
      </div>
      
      <div class="card-body">
        @if (loading() && !currentRate()) {
          <div class="text-center">
            <div class="spinner-border mb-3" role="status" aria-label="Loading exchange rate">
              <span class="visually-hidden">Loading exchange rate...</span>
            </div>
            <p class="text-muted">Fetching current exchange rate...</p>
          </div>
        } @else if (error()) {
          <div class="alert alert-warning" role="alert" aria-live="polite">
            <h5 class="alert-heading">Exchange Rate Error</h5>
            <p class="mb-0">{{ error() }}</p>
            @if (backoffDelay > 5000) {
              <hr>
              <p class="mb-0">
                <small>Current backoff delay: {{ backoffDelay / 1000 }}s</small>
              </p>
            }
          </div>
        } @else if (currentRate()) {
          <div class="exchange-rate-display text-center">
            <div class="rate-container">
              <div class="rate-value" 
                   [class]="getRateColorClass()" 
                   [attr.aria-label]="getRateAriaLabel()">
                <span class="currency-pair">USD/JPY</span>
                <div class="rate-amount">
                  <span class="rate-icon" [attr.aria-hidden]="true">{{ getRateIcon() }}</span>
                  <span class="rate-number">{{ currentRate()!.rate | number:'1.2-4' }}</span>
                </div>
              </div>
            </div>
            
            @if (previousRate()) {
              <div class="rate-change mt-2">
                <small class="text-muted">
                  Previous rate: {{ previousRate() | number:'1.2-4' }}
                </small>
                <br>
                <small [class]="getRateColorClass()">
                  Change: {{ (currentRate()!.rate - previousRate()!) > 0 ? '+' : '' }}{{ (currentRate()!.rate - previousRate()!) | number:'1.4-4' }}
                </small>
              </div>
            }
          </div>
          
          <div class="mt-4">
            <div class="row">
              <div class="col-md-6">
                <div class="info-item">
                  <strong>From:</strong> {{ currentRate()!.fromCurrency }}
                </div>
              </div>
              <div class="col-md-6">
                <div class="info-item">
                  <strong>To:</strong> {{ currentRate()!.toCurrency }}
                </div>
              </div>
            </div>
            
            <div class="row mt-2">
              <div class="col-md-6">
                <div class="info-item">
                  <strong>Last Refreshed:</strong>
                  <br>
                  <small>{{ currentRate()!.lastRefreshed | date:'medium' }}</small>
                </div>
              </div>
              <div class="col-md-6">
                <div class="info-item">
                  <strong>Last Update:</strong>
                  <br>
                  <small>{{ lastUpdate() | date:'medium' }}</small>
                </div>
              </div>
            </div>
            
            <div class="mt-3 p-3 bg-light rounded">
              <div class="d-flex align-items-center">
                <div class="spinner-border spinner-border-sm me-2" 
                     [class.text-success]="!loading()"
                     [class.text-primary]="loading()"
                     role="status" 
                     aria-label="Polling status">
                  <span class="visually-hidden">{{ loading() ? 'Updating' : 'Monitoring' }}</span>
                </div>
                <small class="text-muted">
                  {{ loading() ? 'Updating...' : 'Auto-refreshing every 15 seconds' }}
                </small>
              </div>
            </div>
          </div>
        } @else {
          <div class="text-center text-muted">
            <p>No exchange rate data available.</p>
          </div>
        }
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h4 class="card-title">About This Exchange Rate Monitor</h4>
      </div>
      <div class="card-body">
        <ul class="list-unstyled">
          <li><strong>Data Source:</strong> AlphaVantage API (Demo)</li>
          <li><strong>Update Frequency:</strong> Every 15 seconds</li>
          <li><strong>Rate Limit Handling:</strong> Automatic backoff and mock mode fallback</li>
          <li><strong>Color Indicators:</strong>
            <ul class="mt-2">
              <li><span class="exchange-rate-up">Green ↑</span> - Rate increased</li>
              <li><span class="exchange-rate-down">Red ↓</span> - Rate decreased</li>
              <li><span class="exchange-rate-neutral">Gray →</span> - First load or no change</li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
